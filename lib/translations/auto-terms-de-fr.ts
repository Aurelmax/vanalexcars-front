/**
 * Dictionnaire de traduction Allemand → Français
 * Termes automobiles courants
 */

export const AUTO_TERMS_DE_FR: Record<string, string> = {
  // État et historique
  '1. hand': '1ère main',
  'scheckheftgepflegt': 'Carnet d\'entretien complet',
  'unfallfrei': 'Sans accident',
  'nichtraucherfahrzeug': 'Véhicule non-fumeur',
  'garantie': 'Garantie',

  // Transmission et motorisation
  'tiptronic': 'Boîte automatique Tiptronic',
  'automatik': 'Boîte automatique',
  'schaltgetriebe': 'Boîte manuelle',
  'allradantrieb': 'Transmission intégrale',
  'quattro': 'Quattro (4x4)',
  'xdrive': 'xDrive (4x4)',
  'start-stop-system': 'Système Start-Stop',
  'mild-hybrid': 'Mild-Hybrid',

  // Sécurité
  'abs': 'ABS',
  'esp': 'ESP',
  'wegfahrsperre': 'Antidémarrage',
  'airbag': 'Airbag',
  'isofix': 'Isofix',
  'reifendruckkontrolle': 'Contrôle de pression des pneus',

  // Assistances à la conduite
  'rückfahrkamera': 'Caméra de recul',
  'einparkhilfe': 'Aide au stationnement',
  'parkassistent': 'Assistant de stationnement',
  'spurverlassenswarnung': 'Alerte de franchissement de ligne',
  'spurwechselwarnung': 'Alerte de changement de voie',
  'tempomat': 'Régulateur de vitesse',
  'adaptive cruise control': 'Régulateur de vitesse adaptatif (ACC)',
  'acc': 'Régulateur adaptatif',
  'fernlichtassistent': 'Assistant feux de route',
  'abbiege-assistent': 'Assistant de virage',
  'querverkehrs-assistent': 'Assistant de circulation transversale',
  'totwinkel-assistent': 'Détection angle mort',
  'notbremsassistent': 'Freinage d\'urgence automatique',
  'verkehrszeichenerkennung': 'Reconnaissance des panneaux',
  'müdigkeitswarner': 'Détecteur de fatigue',

  // Confort intérieur
  'klimaautomatik': 'Climatisation automatique',
  '4-zonen': '4 zones',
  'sitzheizung': 'Sièges chauffants',
  'sitzbelüftung': 'Sièges ventilés',
  'massagefunktion': 'Fonction massage',
  'lederlenkrad': 'Volant cuir',
  'multifunktionslenkrad': 'Volant multifonction',
  'schaltwippen': 'Palettes au volant',
  'memory-funktion': 'Fonction mémoire',
  'komfortsitze': 'Sièges confort',
  'sportsitze': 'Sièges sport',
  'elektrisch verstellbar': 'Réglage électrique',
  'lordosenstütze': 'Soutien lombaire',

  // Multimédia
  'navigationssystem': 'Système de navigation',
  'navi': 'GPS',
  'digitaler radioempfang': 'Radio numérique',
  'dab': 'DAB+',
  'bluetooth': 'Bluetooth',
  'freisprecheinrichtung': 'Kit mains-libres',
  'smartphone interface': 'Interface smartphone',
  'apple carplay': 'Apple CarPlay',
  'android auto': 'Android Auto',
  'soundsystem': 'Système audio',
  'harman kardon': 'Harman Kardon',
  'bose': 'Bose',
  'bang & olufsen': 'Bang & Olufsen',
  'b&w': 'Bowers & Wilkins',
  'usb': 'USB',
  'aux': 'Prise AUX',

  // Écrans et affichage
  'head-up display': 'Affichage tête haute',
  'hud': 'Affichage tête haute',
  'virtual cockpit': 'Cockpit virtuel',
  'bordcomputer': 'Ordinateur de bord',
  'digitales cockpit': 'Tableau de bord numérique',
  'multimediasystem': 'Système multimédia',

  // Éclairage
  'led-scheinwerfer': 'Phares LED',
  'xenon-scheinwerfer': 'Phares Xénon',
  'laserlicht': 'Phares Laser',
  'tagfahrlicht': 'Feux de jour',
  'kurvenlicht': 'Éclairage directionnel',
  'nebelscheinwerfer': 'Antibrouillards',
  'ambiente-beleuchtung': 'Éclairage d\'ambiance',

  // Extérieur
  'panorama-glasdach': 'Toit panoramique',
  'schiebedach': 'Toit ouvrant',
  'anhängerkupplung': 'Attelage',
  'ahk': 'Attelage',
  'dachspoiler': 'Becquet de toit',
  'heckspoiler': 'Aileron arrière',
  'außenspiegel': 'Rétroviseurs extérieurs',
  'elektrisch anklappbar': 'Rabattables électriquement',
  'zentralverriegelung': 'Verrouillage centralisé',
  'keyless-go': 'Démarrage sans clé',
  'keyless entry': 'Accès sans clé',
  'komfortschlüssel': 'Clé confort',

  // Jantes et pneus
  'leichtmetallfelgen': 'Jantes alliage',
  'alufelgen': 'Jantes alu',
  'zoll': 'pouces',
  'winterreifen': 'Pneus hiver',
  'sommerreifen': 'Pneus été',
  'ganzjahresreifen': 'Pneus 4 saisons',
  'reifenreparaturset': 'Kit de réparation pneus',
  'ersatzrad': 'Roue de secours',

  // Options et packages
  's line': 'S Line',
  'm sport': 'Pack M Sport',
  'business': 'Pack Business',
  'komfort': 'Pack Confort',
  'optikpaket': 'Pack esthétique',
  'winterpaket': 'Pack hiver',
  'assistenzpaket': 'Pack assistance',

  // Sièges et intérieur
  'leder': 'Cuir',
  'teilleder': 'Cuir partiel',
  'alcantara': 'Alcantara',
  'stoff': 'Tissu',
  'kunstleder': 'Similicuir',
  'stoffhimmel': 'Ciel de toit tissu',
  'lederhimmel': 'Ciel de toit cuir',
  'rücksitzbank': 'Banquette arrière',
  'umklappbar': 'Rabattable',
  'geteilt': 'Divisée',
  'mittelarmlehne': 'Accoudoir central',
  'becherhalter': 'Porte-gobelets',
  'ablagefächer': 'Rangements',

  // Coffre et rangement
  'kofferraum': 'Coffre',
  'gepäckraum': 'Espace de chargement',
  'laderaumabdeckung': 'Cache-bagage',
  'durchladesystem': 'Trappe à skis',

  // Technologie moteur
  'turbolader': 'Turbocompresseur',
  'twin-turbo': 'Bi-turbo',
  'kompressor': 'Compresseur',
  'direkteinspritzung': 'Injection directe',
  'common rail': 'Common Rail',
  'partikelfilter': 'Filtre à particules',
  'adblue': 'AdBlue',
  'scr-system': 'Système SCR (AdBlue)',

  // Performance
  'sportfahrwerk': 'Châssis sport',
  'luftfederung': 'Suspension pneumatique',
  'dämpferregelung': 'Amortissement pilotable',
  'sportauspuff': 'Échappement sport',
  'sportbremsen': 'Freins sport',

  // Divers
  'standheizung': 'Chauffage stationnaire',
  'fernbedienung': 'Télécommande',
  'kindersicherung': 'Sécurité enfants',
  'getönte scheiben': 'Vitres teintées',
  'wärmeschutzverglasung': 'Vitrage athermique',
  'regensensor': 'Détecteur de pluie',
  'lichtsensor': 'Détecteur de luminosité',
};

/**
 * Traduit un texte allemand en français en utilisant le dictionnaire
 */
export function translateAutoTerms(germanText: string): string {
  if (!germanText) return '';

  let translated = germanText.toLowerCase();

  // Remplacer chaque terme trouvé dans le dictionnaire
  Object.entries(AUTO_TERMS_DE_FR).forEach(([german, french]) => {
    const regex = new RegExp(`\\b${german.toLowerCase()}\\b`, 'gi');
    translated = translated.replace(regex, french);
  });

  // Capitaliser la première lettre de chaque phrase
  return translated
    .split('. ')
    .map(sentence => sentence.charAt(0).toUpperCase() + sentence.slice(1))
    .join('. ');
}

/**
 * Parse et structure une description HTML/texte allemande
 */
export function parseGermanDescription(description: string): {
  highlights: string[];
  equipment: {
    security: string[];
    multimedia: string[];
    assistance: string[];
    interior: string[];
    exterior: string[];
    lighting: string[];
    wheels: string[];
    packages: string[];
    other: string[];
  };
} {
  const result = {
    highlights: [] as string[],
    equipment: {
      security: [] as string[],
      multimedia: [] as string[],
      assistance: [] as string[],
      interior: [] as string[],
      exterior: [] as string[],
      lighting: [] as string[],
      wheels: [] as string[],
      packages: [] as string[],
      other: [] as string[],
    },
  };

  // Extraire les highlights
  const highlightsMatch = description.match(/highlights?:(.*?)(?:technik|multimedia|assistenzsysteme|innen|aussen|scheinwerfer|räder|pakete|sonstiges|$)/is);
  if (highlightsMatch) {
    result.highlights = highlightsMatch[1]
      .split(';')
      .map(h => translateAutoTerms(h.trim()))
      .filter(h => h.length > 0);
  }

  // Extraire les équipements par catégorie
  const categories = [
    { key: 'security', pattern: /technik \+ sicherheit:(.*?)(?:multimedia|assistenzsysteme|innen|aussen|scheinwerfer|räder|pakete|sonstiges|$)/is },
    { key: 'multimedia', pattern: /multimedia:(.*?)(?:assistenzsysteme|innen|aussen|scheinwerfer|räder|pakete|sonstiges|$)/is },
    { key: 'assistance', pattern: /assistenzsysteme:(.*?)(?:innen|aussen|scheinwerfer|räder|pakete|sonstiges|$)/is },
    { key: 'interior', pattern: /innen:(.*?)(?:sitze|aussen|scheinwerfer|räder|pakete|sonstiges|$)/is },
    { key: 'exterior', pattern: /aussen:(.*?)(?:scheinwerfer|räder|pakete|sonstiges|$)/is },
    { key: 'lighting', pattern: /scheinwerfer \+ leuchten:(.*?)(?:räder|pakete|sonstiges|$)/is },
    { key: 'wheels', pattern: /räder \+ reifen:(.*?)(?:pakete|sonstiges|$)/is },
    { key: 'packages', pattern: /pakete:(.*?)(?:sonstiges|$)/is },
  ];

  categories.forEach(({ key, pattern }) => {
    const match = description.match(pattern);
    if (match) {
      result.equipment[key as keyof typeof result.equipment] = match[1]
        .split(';')
        .map(item => translateAutoTerms(item.trim()))
        .filter(item => item.length > 0 && item.length < 200); // Exclure les longues phrases
    }
  });

  return result;
}
